<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QCTM9NEWRK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-QCTM9NEWRK');
    </script>

    <meta charset="UTF-8">
    <title>æˆé•·åˆ†æãƒœãƒ¼ãƒ‰ - ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="keyboard.css?v=28">
    <link rel="stylesheet" href="common.css?v=28">

    <style>
        body {
            margin: 0 !important;
            padding-top: 0 !important;
            background: #f1f5f9;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
        }

        .dashboard-wrapper {
            max-width: 1100px;
            margin: 10px auto;
            padding: 0 20px 40px 20px;
        }

        /* ä¸‹éƒ¨ã«ä½™ç™½è¿½åŠ  */

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .dashboard-title {
            font-size: 24px;
            font-weight: bold;
            color: #334155;
            min-width: 180px;
        }

        .current-rank-container {
            display: flex;
            justify-content: center;
            flex-grow: 1;
        }

        .rank-display-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: #fff;
            color: #4f46e5;
            border: 2px solid #6366f1;
            padding: 6px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            height: 36px;
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .action-area {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .action-btn,
        .reset-btn {
            cursor: pointer;
            font-size: 14px;
            padding: 6px 16px;
            border-radius: 6px;
            height: 36px;
            box-sizing: border-box;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .action-btn:hover {
            filter: brightness(0.95);
        }

        .reset-btn {
            background: #fee2e2;
            border: 1px solid #f87171;
            color: #991b1b;
        }

        .reset-btn:hover {
            background: #fecaca;
        }

        /* ã‚«ãƒ¼ãƒ‰ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px 15px;
            border-top: 4px solid #cbd5e1;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: #1e293b;
            line-height: 1.2;
        }

        .stat-unit {
            font-size: 14px;
            color: #64748b;
            margin-left: 4px;
        }

        .stat-sub {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .card-score .stat-value {
            color: #d97706;
        }

        /* ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ */
        .accordion-box {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .accordion-summary {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: bold;
            color: #475569;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
            list-style: none;
        }

        .accordion-summary::-webkit-details-marker {
            display: none;
        }

        .accordion-summary:hover {
            background: #f1f5f9;
        }

        .accordion-summary::after {
            content: '+';
            font-size: 18px;
            font-weight: bold;
            transition: transform 0.2s;
        }

        details[open] .accordion-summary::after {
            content: '-';
        }

        .accordion-content {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
        }

        /* ãƒãƒ£ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£ */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* ãƒãƒ£ãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰è‡ªä½“ã¯é«˜ã•å›ºå®šã—ãªã„ */
        .chart-card-wrapper {
            width: 100%;
        }

        .chart-header {
            margin-bottom: 10px;
            font-weight: bold;
            text-align: center;
        }

        /* Canvasã‚’å›²ã‚€ãƒ©ãƒƒãƒ‘ãƒ¼ã«é«˜ã•ã‚’æŒ‡å®šã™ã‚‹ */
        .chart-canvas-container {
            position: relative;
            height: 280px;
            /* ã“ã“ã§é«˜ã•ã‚’ç¢ºä¿ */
            width: 100%;
        }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            margin-top: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #64748b;
            background: #f8fafc;
        }

        .calendar-day.active {
            background: #dcfce7;
            border-color: #86efac;
            color: #166534;
            font-weight: bold;
        }

        .calendar-icon {
            font-size: 16px;
            line-height: 1;
            margin-top: 2px;
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        table.data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            text-align: center;
        }

        table.data-table th,
        table.data-table td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        table.data-table th {
            background-color: #f8fafc;
            color: #475569;
            font-weight: 600;
        }

        .key-badge {
            display: inline-block;
            padding: 2px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            font-weight: bold;
            font-family: monospace;
        }

        .heatmap-legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            gap: 10px;
            font-size: 14px;
            color: #555;
            padding-bottom: 20px;
        }

        .legend-bar {
            width: 200px;
            height: 12px;
            background: linear-gradient(to right, #ffffff, #e0f2fe, #fef08a, #fdba74, #ef4444);
            border: 1px solid #ccc;
            border-radius: 6px;
        }
    </style>
    <link rel="canonical" href="https://typingmasterneo.com/results.html">
</head>

<body>

    <div class="nav">
        <a href="index.html">Top</a>
        <a href="home.html">ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã‚¿ãƒƒãƒã¨ã¯</a>
        <a href="about.html">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
        <a href="results.html" style="font-weight:700; color:#2563eb;">æˆé•·åˆ†æãƒœãƒ¼ãƒ‰</a>
        <a href="contact.html">ãŠå•ã„åˆã‚ã›</a>
        <a href="privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
        <span id="visit-counter">è¨ªå•æ•°ï¼š--</span>
    </div>

    <div class="dashboard-wrapper">
        <div class="dashboard-header">
            <div class="dashboard-title">æˆé•·åˆ†æãƒœãƒ¼ãƒ‰</div>
            <div class="current-rank-container">
                <div id="rankBadgeDisplay" class="rank-display-badge" style="display:none;">
                    <span>ç¾åœ¨ã®å®ŸåŠ›è©•ä¾¡:</span>
                    <span id="headerRankText">--</span>
                </div>
            </div>
            <div class="action-area">
                <button onclick="exportData()" class="action-btn"
                    style="background:#e0f2fe; border:1px solid #7dd3fc; color:#0369a1;">ãƒ‡ãƒ¼ã‚¿ä¿å­˜(DL)</button>
                <button onclick="triggerImport()" class="action-btn"
                    style="background:#f0fdf4; border:1px solid #86efac; color:#15803d;">ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ</button>
                <input type="file" id="importFile" style="display:none;" accept=".json" onchange="importData(this)">
                <button onclick="clearData()" class="reset-btn">å…¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card" style="border-top-color: #f59e0b;">
                <div class="stat-label">ç·åˆè©•ä¾¡ (Score)</div>
                <div class="stat-value card-score"><span id="val-score">--</span></div>
                <div class="stat-sub" id="val-rank-sub">ãƒ©ãƒ³ã‚¯: --</div>
            </div>
            <div class="stat-card" style="border-top-color: #64748b;">
                <div class="stat-label">ç¶™ç¶šå›æ•°</div>
                <div class="stat-value"><span id="val-count">--</span><span class="stat-unit">å›</span></div>
                <div class="stat-sub">ç¶™ç¶šã¯åŠ›ãªã‚Šï¼</div>
            </div>
            <div class="stat-card" style="border-top-color: #8b5cf6;">
                <div class="stat-label">ç·ç·´ç¿’æ™‚é–“</div>
                <div class="stat-value"><span id="val-time">--</span><span class="stat-unit"
                        style="font-size:16px;"></span></div>
                <div class="stat-sub">ç©ã¿ä¸Šã’ãŸåŠªåŠ›ã®è¨¼</div>
            </div>
            <div class="stat-card" style="border-top-color: #3b82f6;">
                <div class="stat-label">å¹³å‡æ­£ç¢ºç‡</div>
                <div class="stat-value"><span id="val-acc">--</span><span class="stat-unit">%</span></div>
                <div class="stat-sub">ç›´è¿‘å¹³å‡ (å®‰å®šæ„Ÿ)</div>
            </div>
            <div class="stat-card" style="border-top-color: #10b981;">
                <div class="stat-label">å¹³å‡ã‚¹ãƒ”ãƒ¼ãƒ‰</div>
                <div class="stat-value"><span id="val-speed">--</span><span class="stat-unit">key/s</span></div>
                <div class="stat-sub">é€Ÿã•ã¨æ­£ç¢ºã•ã®ãƒãƒ©ãƒ³ã‚¹</div>
            </div>
        </div>

        <details class="accordion-box" open>
            <summary class="accordion-summary">ğŸ“… ç¶™ç¶šçŠ¶æ³ (æ—¥ã€…ã®ç©ã¿ä¸Šã’)</summary>
            <div class="accordion-content">
                <div style="margin-bottom:20px;">
                    <div style="font-weight:bold; color:#64748b; margin-bottom:10px;">ç›´è¿‘30æ—¥ã®ç¶™ç¶šãƒã‚§ãƒƒã‚¯ (ğŸ˜Š:OK)</div>
                    <div id="calendarArea" class="calendar-grid"></div>
                </div>
                <!-- ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ -->
                <div class="chart-card-wrapper">
                    <div class="chart-header" style="color: #8b5cf6;">â±ï¸ æ—¥ã”ã¨ã®ç·´ç¿’æ™‚é–“ (åˆ†)</div>
                    <div class="chart-canvas-container">
                        <canvas id="chartDailyTime"></canvas>
                    </div>
                </div>
            </div>
        </details>

        <details class="accordion-box" open>
            <summary class="accordion-summary">ğŸ“ˆ å®ŸåŠ›ã®æ¨ç§»ã‚°ãƒ©ãƒ• (è©•ä¾¡å€¤ãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ»æ­£ç¢ºç‡)</summary>
            <div class="accordion-content">
                <div class="charts-grid">
                    <div class="chart-card-wrapper">
                        <div class="chart-header" style="color: #f59e0b;">ğŸ”¥ ç·åˆè©•ä¾¡å€¤ (Score)</div>
                        <div class="chart-canvas-container">
                            <canvas id="chartScore"></canvas>
                        </div>
                    </div>
                    <div class="chart-card-wrapper">
                        <div class="chart-header" style="color: #10b981;">ğŸš€ ã‚¹ãƒ”ãƒ¼ãƒ‰ (key/s)</div>
                        <div class="chart-canvas-container">
                            <canvas id="chartSpeed"></canvas>
                        </div>
                    </div>
                    <div class="chart-card-wrapper">
                        <div class="chart-header" style="color: #3b82f6;">ğŸ¯ æ­£ç¢ºç‡ (%)</div>
                        <div class="chart-canvas-container">
                            <canvas id="chartAccuracy"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <details class="accordion-box">
            <summary class="accordion-summary">âŒ¨ï¸ è‹¦æ‰‹ã‚­ãƒ¼ ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ— & åˆ†æè¡¨</summary>
            <div class="accordion-content">
                <div id="heatmapSection" style="text-align:center;">
                    <div style="margin-bottom:15px; color:#666;">èµ¤è‰²ãŒæ¿ƒã„ã‚­ãƒ¼ã»ã©ãƒŸã‚¹ãŒå¤šã„ã‚­ãƒ¼ã§ã™</div>
                    <div class="center-card keyboard-card">
                        <div id="keyboardBox"></div>
                    </div>
                    <div class="heatmap-legend">
                        <span>è‰¯ (ç™½)</span>
                        <div class="legend-bar"></div>
                        <span>(èµ¤) è‹¦æ‰‹</span>
                    </div>

                    <div style="margin-top:30px; text-align:left;">
                        <h3 style="font-size:16px; color:#334155; border-left:4px solid #ef4444; padding-left:10px;">
                            ãƒ¯ãƒ¼ã‚¹ãƒˆã‚­ãƒ¼ãƒ©ãƒ³ã‚­ãƒ³ã‚° (ãƒŸã‚¹ã®å¤šã„é †)</h3>
                        <div class="table-container">
                            <table class="data-table" id="weakKeysTable">
                                <thead>
                                    <tr>
                                        <th>é †ä½</th>
                                        <th>ã‚­ãƒ¼</th>
                                        <th>ãƒŸã‚¹ç‡</th>
                                        <th>ãƒŸã‚¹å›æ•°</th>
                                        <th>ç·å…¥åŠ›æ•°</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <div id="noData"
            style="display:none; text-align:center; padding:60px 20px; color:#64748b; margin-top:30px; background:white; border-radius:12px;">
            ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã¾ãšã¯ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ†ã‚¹ãƒˆã«æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼<br><br>
            <a href="index.html" style="color:#3b82f6; text-decoration:underline;">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
        </div>
    </div>

    <script>
        function loadData() {
            const results = JSON.parse(localStorage.getItem('typingTestResults') || '[]');
            const keyStats = JSON.parse(localStorage.getItem("neotyping_stats") || "{}");

            if (results.length === 0) {
                document.querySelector('.stats-grid').style.display = 'none';
                document.querySelectorAll('.accordion-box').forEach(el => el.style.display = 'none');
                document.getElementById('rankBadgeDisplay').style.display = 'none';
                document.getElementById('noData').style.display = 'block';
                return;
            }

            results.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                if (isNaN(dateA.getTime())) return -1; // æ—¥ä»˜ãªã—ã¯éå»æ‰±ã„
                if (isNaN(dateB.getTime())) return 1;
                return dateA - dateB;
            });
            // ãƒ‡ãƒ¼ã‚¿è£œæ­£ & NaNã‚¬ãƒ¼ãƒ‰
            const stats = results.map(r => {
                let limit = Number(r.timeLimit) || 30;
                let correct = Number(r.correctCount) || 0;
                let total = Number(r.totalKeyStrokes) || Number(r.attemptedCount) || 0;

                let speed = Number(r.speed);
                if (isNaN(speed)) {
                    speed = correct / limit;
                }

                let acc = Number(r.accuracy);
                if (isNaN(acc)) {
                    let denom = total || correct; // åˆ†æ¯ç¢ºä¿
                    acc = denom > 0 ? (correct / denom) * 100 : 0;
                }

                let score = Number(r.score);
                // scoreãŒç„¡åŠ¹ã€ã¾ãŸã¯ã€Œ0ã€ã ãŒå®Ÿã¯ã¡ã‚ƒã‚“ã¨æ‰“ã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯å†è¨ˆç®—
                if (isNaN(score) || (score === 0 && acc > 0 && speed > 0)) {
                    score = Math.round(acc * speed);
                }

                // æœ€çµ‚å®‰å…¨è£…ç½®
                if (isNaN(speed)) speed = 0;
                if (isNaN(acc)) acc = 0;
                if (isNaN(score)) score = 0;

                return { ...r, speed, acc, score, limit };
            }).filter(s => s.totalKeyStrokes > 2 && s.score >= 0); // 3æ‰“ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æœ‰åŠ¹ã¨ã™ã‚‹ï¼ˆèª¤æ“ä½œã‚„å³çµ‚äº†ã‚’é™¤å¤–ï¼‰

            if (stats.length === 0) {
                document.querySelector('.stats-grid').style.display = 'none';
                document.querySelectorAll('.accordion-box').forEach(el => el.style.display = 'none');
                document.getElementById('rankBadgeDisplay').style.display = 'none';
                document.getElementById('noData').style.display = 'block';
                return;
            }

            const count = stats.length; // æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿æ•°

            // æœ€æ–°ã®æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿ï¼ˆãŸã ã—ã‚¹ã‚³ã‚¢0ã¯ãƒãƒ¼ã‚«ã‚¦ãƒ³ãƒˆæ‰±ã„ã—ã¦ã€ãã®å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¡ç”¨ã™ã‚‹ï¼‰
            let lastStat = stats[count - 1];
            for (let i = count - 1; i >= 0; i--) {
                if (stats[i].score > 0) {
                    lastStat = stats[i];
                    break;
                }
            }

            let rank = "D (æ–°äºº)";
            if (lastStat.score >= 400) rank = "S (é”äºº)";
            else if (lastStat.score >= 300) rank = "A (ä¸Šç´š)";
            else if (lastStat.score >= 200) rank = "B (ä¸­ç´š)";
            else if (lastStat.score >= 100) rank = "C (åˆç´š)";

            document.getElementById('headerRankText').textContent = `${rank} (Score: ${lastStat.score})`;
            document.getElementById('rankBadgeDisplay').style.display = 'inline-flex';
            document.getElementById('val-score').textContent = lastStat.score;
            document.getElementById('val-rank-sub').textContent = `ãƒ©ãƒ³ã‚¯: ${rank}`;
            document.getElementById('val-count').textContent = count;

            const totalSeconds = stats.reduce((sum, s) => sum + s.limit, 0);
            const totalH = Math.floor(totalSeconds / 3600);
            const totalM = Math.floor((totalSeconds % 3600) / 60);
            document.getElementById('val-time').textContent = (totalH > 0 ? totalH + "æ™‚é–“ " : "") + totalM + "åˆ†";

            document.getElementById('val-acc').textContent = (stats.reduce((s, v) => s + v.acc, 0) / count).toFixed(1);
            document.getElementById('val-speed').textContent = (stats.reduce((s, v) => s + v.speed, 0) / count).toFixed(1);

            renderCharts(stats);
            renderCalendar(stats);
            renderWeakKeyTable(keyStats);

            if (window.createKeyboard) {
                createKeyboard();
                if (window.applyHeatmap) applyHeatmap(keyStats);
            }
        }

        function renderCharts(stats) {
            const labels = stats.map(s => { const d = new Date(s.date); return `${d.getMonth() + 1}/${d.getDate()}`; });

            createLineChart('chartScore', labels, stats.map(s => s.score), 'è©•ä¾¡å€¤', '#f59e0b');
            createLineChart('chartSpeed', labels, stats.map(s => s.speed), 'Speed (key/s)', '#10b981');
            createLineChart('chartAccuracy', labels, stats.map(s => s.acc), 'æ­£ç¢ºç‡ (%)', '#3b82f6');

            const dailyTimeMap = {};
            stats.forEach(s => {
                const d = new Date(s.date).toISOString().split('T')[0];
                dailyTimeMap[d] = (dailyTimeMap[d] || 0) + s.limit;
            });
            const sortedDates = Object.keys(dailyTimeMap).sort();
            const timeLabels = sortedDates.map(d => d.slice(5));
            const timeData = sortedDates.map(d => Math.round(dailyTimeMap[d] / 60));

            new Chart(document.getElementById('chartDailyTime'), {
                type: 'bar',
                data: {
                    labels: timeLabels,
                    datasets: [{ label: 'ç·´ç¿’æ™‚é–“ (åˆ†)', data: timeData, backgroundColor: '#a78bfa', borderRadius: 4 }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function createLineChart(id, labels, data, label, color) {
            new Chart(document.getElementById(id), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{ label: label, data: data, borderColor: color, backgroundColor: color + '20', tension: 0.3, fill: true }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function renderCalendar(stats) {
            const container = document.getElementById('calendarArea');
            container.innerHTML = "";
            const today = new Date();
            const days = [];
            for (let i = 29; i >= 0; i--) {
                const d = new Date(); d.setDate(today.getDate() - i);
                days.push(d.toISOString().split('T')[0]);
            }
            const activeDays = new Set(stats.map(s => new Date(s.date).toISOString().split('T')[0]));
            days.forEach(dateStr => {
                const isPlayed = activeDays.has(dateStr);
                const el = document.createElement('div');
                el.className = `calendar-day ${isPlayed ? 'active' : 'inactive'}`;
                const md = dateStr.slice(5).replace('-', '/');
                el.innerHTML = `<span>${md}</span><span class="calendar-icon">${isPlayed ? 'ğŸ˜Š' : 'ğŸ˜­'}</span>`;
                container.appendChild(el);
            });
        }

        function renderWeakKeyTable(stats) {
            const tbody = document.querySelector('#weakKeysTable tbody');
            tbody.innerHTML = "";
            const keys = Object.keys(stats).filter(k => stats[k].total >= 5);
            if (keys.length === 0) { tbody.innerHTML = "<tr><td colspan='5'>ãƒ‡ãƒ¼ã‚¿ä¸è¶³ã§ã™</td></tr>"; return; }
            keys.sort((a, b) => (stats[b].miss / stats[b].total) - (stats[a].miss / stats[a].total));
            keys.slice(0, 10).forEach((key, idx) => {
                const d = stats[key];
                const rate = ((d.miss / d.total) * 100).toFixed(1);
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${idx + 1}ä½</td><td><span class="key-badge">${key}</span></td>
                    <td style="color:${rate > 20 ? '#ef4444' : '#334155'}"><b>${rate}%</b></td><td>${d.miss}å›</td><td>${d.total}å›</td>`;
                tbody.appendChild(tr);
            });
        }

        window.onload = loadData;
    </script>
    <script src="keyboard.js?v=28"></script>
    <script src="start.js?v=28"></script>
</body>

</html>