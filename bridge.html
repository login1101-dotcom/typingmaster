<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <title>NEO Data Bridge</title>
</head>

<body>
    <script>
        // 1. iframe用 (親ウィンドウからのリクエスト待機)
        window.addEventListener('message', (event) => {
            if (event.data.action === 'getTypingData') {
                sendData(event.source, event.origin);
            }
        });

        // 2. ポップアップ用 (開かれたら即送信して閉じる)
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            if (params.get('mode') === 'popup') {
                if (window.opener) {
                    sendData(window.opener, '*');
                    // 送信後、少し待ってから閉じる（確実に届けるため）
                    setTimeout(() => {
                        window.close();
                    }, 500);
                }
            }
        });

        function sendData(targetWindow, targetOrigin) {
            const data = localStorage.getItem('typingTestResults') || '[]';
            const title = localStorage.getItem('typingTitles') || '[]';
            const settings = localStorage.getItem('typingSettings') || '{}';

            targetWindow.postMessage({
                action: 'returnTypingData',
                data: data,
                titles: title,
                settings: settings
            }, targetOrigin);
        }
    </script>
</body>

</html>